<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotaract Club Invoice Calculator | Rotaract South Asia MDIO</title>

	    <meta name="description" content="Club Invoice Calculator is an interactive tool by Rotaract South Asia MDIO (RSAMDIO) to help Rotaractors estimate their Club Invoices with precision and ease.">
    <meta name="author" content="ZeoSpec">

    <link rel="canonical" href="https://rsamdio.org/invoice"> 

    <meta property="og:title" content="Rotaract Club Invoice Calculator | Rotaract South Asia MDIO">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rsamdio.org/invoice">
    <meta property="og:site_name" content="Rotaract Club Invoice Calculator | Rotaract South Asia MDIO" />
    <meta property="og:image" content="https://rsamdio.org/img/calculatorogimg.png" />
    <meta property="og:description" content="Club Invoice Calculator is an interactive tool by Rotaract South Asia MDIO (RSAMDIO) to help Rotaractors estimate their Club Invoices with precision and ease.">
    
    <meta name="keywords" content="Rotaract, Rotary, Rotaract South Asia, Club Invoice, RSAMDIO, RI Dues" />

    <meta name="subject" content="Rotaract Club Invoice Calculator | Rotaract South Asia MDIO">

    <meta name="url" content="https://rsamdio.org">
    <meta name="identifier-URL" content="https://rsamdio.org">
    
    <meta http-equiv="cache-control" content="public" />
    <meta http-equiv="Expires" content="0">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="./img/favicon.png" type="image/x-icon">
    <link rel="icon" href="./img/favicon.png" type="image/x-icon">
	

    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
    
    <!-- Optimized Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Defer non-critical scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" defer></script>
    <style>
        /* Remove duplicate font import since we're preloading it */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
            color: #4a5568;
        }
        .rotary-blue-dark { background-color: #003b8a; }
        .rotary-blue-dark-text { color: #003b8a; }
        .rotary-blue-light { background-color: #eaf2ff; }
        .rotary-blue-light-text { color: #004aad; }
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: #004aad;
            color: white;
        }
        .btn-primary:hover {
            background-color: #003b8a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 74, 173, 0.2);
        }
        .btn-danger {
            background-color: #e53e3e;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c53030;
        }
        .btn-secondary {
            background-color: #edf2f7;
            color: #4a5568;
            border-color: #e2e8f0;
        }
        .btn-secondary:hover {
            background-color: #e2e8f0;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            border: 1px solid #e2e8f0;
        }
        input[type="text"], input[type="date"], select {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 0.625rem 0.875rem;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input[type="text"]:focus, input[type="date"]:focus, select:focus {
            outline: none;
            border-color: #0079ff;
            box-shadow: 0 0 0 3px rgba(0, 121, 255, 0.15);
            background-color: white;
        }
        .table-header {
            background-color: #f7fafc;
        }
        .form-input-sm, .form-select-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        /* Enhanced styles for edit mode inputs */
        .edit-mode-input {
            width: 100% !important;
            min-width: 120px;
            padding: 0.5rem 0.75rem !important;
            font-size: 0.875rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.375rem;
            background-color: white;
            transition: all 0.2s ease-in-out;
            box-sizing: border-box;
            margin: 0;
            display: block;
        }
        
        .edit-mode-input:focus {
            outline: none;
            border-color: #004aad;
            box-shadow: 0 0 0 3px rgba(0, 74, 173, 0.1);
            background-color: #f8fafc;
        }
        
        .edit-mode-select {
            width: 100% !important;
            min-width: 140px;
            padding: 0.5rem 0.75rem !important;
            font-size: 0.875rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.375rem;
            background-color: white;
            transition: all 0.2s ease-in-out;
            box-sizing: border-box;
            cursor: pointer;
            margin: 0;
            display: block;
        }
        
        .edit-mode-select:focus {
            outline: none;
            border-color: #004aad;
            box-shadow: 0 0 0 3px rgba(0, 74, 173, 0.1);
            background-color: #f8fafc;
        }
        
        /* Enhanced table cell styling for edit mode */
        .editing td {
            background-color: #f8fafc !important;
            border-color: #e2e8f0;
        }
        
        .editing td:focus-within {
            background-color: #f0f9ff !important;
        }
        
        /* Ensure table cells have proper spacing for edit mode - match header padding */
        .editing td {
            padding: 1rem 1.5rem !important; /* px-6 py-4 equivalent */
            vertical-align: middle;
        }
        
        /* Make sure inputs don't overflow table cells and maintain alignment */
        .editing td input,
        .editing td select {
            max-width: 100%;
            box-sizing: border-box;
            position: static;
        }
        
        /* Ensure table structure is maintained */
        .editing td {
            position: static;
            display: table-cell;
            vertical-align: middle;
        }
        
        /* Add subtle visual feedback for editing state without affecting layout */
        .editing {
            background-color: #f8fafc !important;
            border-left: 3px solid #004aad;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
        }
        .file-upload-area:hover {
            border-color: #004aad;
            background-color: #f8fafc;
        }
        .file-upload-area.dragover {
            border-color: #004aad;
            background-color: #eaf2ff;
        }
        .upload-preview {
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* Upload area transitions */
        .upload-area-container {
            transition: all 0.3s ease-in-out;
        }
        
        .upload-area-container.hidden {
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
        }
        
        .upload-preview {
            transition: all 0.3s ease-in-out;
        }
        
        .upload-preview.hidden {
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
        }
        
        /* Success animation */
        .success-animation {
            animation: successPulse 1.5s ease-in-out;
        }
        
        @keyframes successPulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .success-icon {
            animation: successBounce 0.6s ease-in-out;
        }
        
        @keyframes successBounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -8px, 0);
            }
            70% {
                transform: translate3d(0, -4px, 0);
            }
            90% {
                transform: translate3d(0, -2px, 0);
            }
        }
        .member-row {
            transition: all 0.2s ease-in-out;
        }
        .member-row:hover {
            background-color: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 0.375rem;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        /* Enhanced UX Components */
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Enhanced form states */
        .form-group {
            position: relative;
        }
        
        .error-message {
            color: #e53e3e;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .input-error {
            border-color: #e53e3e !important;
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1) !important;
        }
        
        .input-success {
            border-color: #38a169 !important;
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1) !important;
            background-color: #f0fff4 !important;
        }
        
        /* Enhanced validation feedback */
        .form-group {
            position: relative;
            transition: all 0.2s ease-in-out;
        }
        
        .form-group:has(.input-success) {
            transform: translateY(-1px);
        }
        
        .form-group:has(.input-error) {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Enhanced accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus indicators */
        .btn:focus,
        input:focus,
        select:focus {
            outline: 2px solid #004aad;
            outline-offset: 2px;
        }
        
        /* Enhanced mobile responsiveness */
        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Enhanced table responsiveness */
        @media (max-width: 768px) {
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .table-responsive table {
                min-width: 600px;
            }
        }
        
        /* Enhanced button states */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn:disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Enhanced file upload area */
        .file-upload-area.dragover {
            border-color: #004aad;
            background-color: #eaf2ff;
            transform: scale(1.02);
        }
        
        /* Enhanced success states */
        .success-feedback {
            background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
            border: 1px solid #68d391;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .error-feedback {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            border: 1px solid #fc8181;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
    </style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4F8DL7KLQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Z4F8DL7KLQ');
    </script>

</head>
<body class="antialiased">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="text-center">
            <div class="loading-spinner w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full mx-auto mb-4"></div>
            <p class="text-gray-600 font-medium">Loading...</p>
        </div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="text-center mb-12">
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-3xl p-8 mb-8 border border-blue-100">
                <img src="https://res.cloudinary.com/frontly/image/upload/v1719324049/pink_v5vpyh.png" alt="Rotaract Logo" class="mx-auto h-24 mb-6 drop-shadow-lg">
                <h1 class="text-4xl sm:text-5xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-4">Rotaract Club Invoice Calculator</h1>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto leading-relaxed">An interactive tool to help Rotaractors estimate their Club Invoices with precision and ease.</p>
                <div class="flex items-center justify-center mt-6 space-x-4 text-sm text-gray-500">
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Easy to use
                    </div>
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Bulk upload support
                    </div>
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Real-time calculations
                    </div>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left Column: Add Member & Bulk Upload -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Add New Member Card -->
                <div class="card p-6 shadow-lg border-0">
                    <div class="text-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">Add New Member</h2>
                        <p class="text-sm text-gray-500 mt-1">Add individual members to your roster</p>
                    </div>
                    <form id="add-member-form" class="space-y-5">
                        <div class="form-group space-y-2">
                            <label for="member-name" class="block text-sm font-semibold text-gray-700 text-center">Member Name <span class="text-red-500">*</span></label>
                            <input type="text" id="member-name" 
                                   class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-center"
                                   placeholder="Enter member's full name"
                                   aria-describedby="member-name-error">
                            <div id="member-name-error" class="error-message text-center"></div>
                        </div>
                        <div class="form-group space-y-2">
                            <label for="member-type" class="block text-sm font-semibold text-gray-700 text-center">Club Base <span class="text-red-500">*</span></label>
                            <select id="member-type" 
                                    class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-center"
                                    aria-describedby="member-type-error">
                                <option value="">Select Club Base</option>
                                <option value="Community-Based">Community-Based ($8)</option>
                                <option value="University-Based">University-Based ($5)</option>
                            </select>
                            <div id="member-type-error" class="error-message text-center"></div>
                        </div>
                        <div class="form-group space-y-2">
                            <label for="join-date" class="block text-sm font-semibold text-gray-700 text-center">Join Date <span class="text-red-500">*</span></label>
                            <input type="date" id="join-date" 
                                   class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-center"
                                   aria-describedby="join-date-error">
                            <div id="join-date-error" class="error-message text-center"></div>
                        </div>
                        <div class="form-group space-y-2">
                            <label for="leave-date" class="block text-sm font-semibold text-gray-700 text-center">Leave Date (Optional)</label>
                            <input type="date" id="leave-date" 
                                   class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-center"
                                   placeholder="Leave blank if still active"
                                   aria-describedby="leave-date-error">
                            <div id="leave-date-error" class="error-message text-center"></div>
                        </div>
                        <button type="submit" id="add-member-button" class="btn btn-primary w-full !mt-6 py-3 text-base font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>
                            Add Member
                        </button>
                    </form>
                </div>

                <!-- Bulk Upload Card -->
                <div class="card p-6 shadow-lg border-0">
                    <div class="text-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">Bulk Upload Roster</h2>
                        <p class="text-sm text-gray-500 mt-1">Upload multiple members at once</p>
                    </div>
                    
                    <!-- File Upload Area -->
                    <div id="file-upload-area" class="file-upload-area upload-area-container p-8 text-center mb-6 bg-gradient-to-br from-gray-50 to-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="text-base text-gray-600 mb-3 font-medium">Drag and drop your file here, or</p>
                        <input type="file" id="file-input" accept=".xlsx,.xls,.csv" class="hidden">
                        <button type="button" id="browse-button" class="btn btn-secondary text-sm px-6 py-3 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            Browse Files
                        </button>
                        <p class="text-xs text-gray-500 mt-3">Supports Excel (.xlsx, .xls) and <br><b>CSV (Recommended)</b> files </p>
                    </div>
                    
                    <!-- Upload Preview -->
                    <div id="upload-preview" class="hidden mb-6">
                        <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Preview
                        </h3>
                        <div id="preview-content" class="upload-preview bg-gray-50 p-4 rounded-lg border border-gray-200 text-sm"></div>
                        <div class="flex gap-3 mt-4">
                            <button type="button" id="confirm-upload" class="btn btn-primary text-sm flex-1 py-3 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                </svg>
                                Add to Roster
                            </button>
                            <button type="button" id="cancel-upload" class="btn btn-secondary text-sm py-3 px-4 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
                                Cancel
                            </button>
                        </div>
                    </div>

                    <!-- File Format Instructions -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-100 mb-6">
                        <h3 class="text-sm font-bold text-blue-800 mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Expected File Format
                        </h3>
                        <div class="text-sm text-blue-700 space-y-2">
                            <div class="flex items-center">
                                <span class="w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 mr-3">A</span>
                                <span><strong>Member Name</strong> (e.g., John Doe)</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 mr-3">B</span>
                                <span><strong>Join Date</strong> (YYYY-MM-DD format)</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 mr-3">C</span>
                                <span><strong>Club Base</strong> (Community-Based or University-Based)</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-6 h-6 bg-blue-200 rounded-full flex items-center justify-center text-xs font-bold text-blue-800 mr-3">D</span>
                                <span><strong>Leave Date</strong> (YYYY-MM-DD format, leave blank if still active)</span>
                            </div>
                        </div>
                        <div class="mt-4 pt-3 border-t border-blue-200">
                            <button type="button" id="download-template" class="text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                Download Template
                            </button>
                        </div>
                    </div>


                </div>
            </div>

            <!-- Right Column: Summary & Roster -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Invoice Summary Card -->
                <div class="card p-8 shadow-lg border-0">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Invoice Summary</h2>
                        <p class="text-gray-500">View your estimated club invoice</p>
                    </div>
                    
                    <div class="mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Invoice Year Selection -->
                            <div class="bg-gradient-to-br from-gray-50 to-blue-50 p-6 rounded-xl border border-blue-100 shadow-sm hover:shadow-md transition-all duration-300">
                                <label for="invoice-year-select" class="block text-m font-bold text-blue-700 mb-3 text-center">Invoice of January</label>
                                <select id="invoice-year-select" class="w-full px-4 py-3 border-2 border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-center font-semibold bg-white shadow-sm">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                                <div class="text-center mt-3">
                                    <div>        
                                        <p class="text-sm text-blue-600">Select the invoice year</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Tax Percentage Input -->
                            <div class="bg-gradient-to-br from-gray-50 to-green-50 p-6 rounded-xl border border-green-100 shadow-sm hover:shadow-md transition-all duration-300">
                                <label for="tax-percentage" class="block text-m font-bold text-green-700 mb-3 text-center">Tax Percentage (%)</label>
                                <div class="relative">
                                    <input type="number" id="tax-percentage" min="0" max="100" step="0.01" value="18" 
                                           class="w-full px-4 py-3 pr-12 border-2 border-green-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 text-center font-semibold bg-white shadow-sm" 
                                           placeholder="18">
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <span class="text-green-600 font-semibold">%</span>
                                    </div>
                                </div>
                                <div class="text-center mt-3">
                                    <div>
                                        <p class="text-sm text-green-600">Configure tax percentage</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-8 rounded-2xl border border-blue-100 text-center">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <p class="text-lg text-blue-700 font-semibold mb-2">Base RI Dues</p>
                                <p id="base-invoice-amount" class="text-4xl font-bold text-blue-800 tracking-tight my-2">$0.00</p>
                                <p id="dues-breakdown" class="text-sm text-gray-600">Full Year: $0.00 + Prorated: $0.00</p>
                            </div>
                            <div>
                                <p class="text-lg text-green-700 font-semibold mb-2">Total with Tax</p>
                                <p id="total-invoice-amount" class="text-4xl font-bold text-green-800 tracking-tight my-2">$0.00</p>
                                <p id="tax-breakdown" class="text-sm text-gray-600">Tax: $0.00 (18%)</p>
                            </div>
                        </div>
                        
                        <!-- Horizontal Line -->
                        <div class="border-t border-blue-200 my-6"></div>
                        
                        <!-- Additional Summary Data -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div class="text-center">
                                <p class="text-sm text-gray-500 font-medium mb-1">Members</p>
                                <p id="total-members" class="text-2xl font-semibold text-gray-700 tracking-tight">0</p>
                                <p class="text-xs text-gray-400">Total Full Year Dues</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 font-medium mb-1">Months</p>
                                <p id="total-prorated-months" class="text-2xl font-semibold text-gray-700 tracking-tight">0</p>
                                <p class="text-xs text-gray-400">Total of Months in Prorata Calculation</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Member Roster Card -->
                <div class="card p-8 shadow-lg border-0">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6">
                        <div class="flex items-center mb-4 sm:mb-0">
                            <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">Member Roster</h2>
                                <p class="text-sm text-gray-500">Manage your club members</p>
                            </div>
                        </div>
                        <button id="reset-button" class="btn btn-secondary text-sm px-6 py-3 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            Reset Roster
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto -mx-8 table-responsive">
                        <table class="min-w-full" role="table" aria-label="Member roster">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                                <tr>
                                    <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Name</th>
                                    <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Join Date</th>
                                    <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Leave Date</th>
                                    <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Club Base</th>
                                    <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">
                                        Est. Due
                                        <div class="text-xs font-normal text-gray-500 normal-case mt-1">(Full Year + Prorated)</div>
                                    </th>
                                    <th scope="col" class="relative px-6 py-4"><span class="sr-only">Actions</span></th>
                                </tr>
                            </thead>
                            <tbody id="member-roster-body" class="bg-white divide-y divide-gray-100">
                                <!-- Rows will be dynamically injected here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="empty-state" class="text-center py-12">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No members yet</h3>
                        <p class="text-gray-500 mb-4">Add members individually or upload a roster file to get started</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Similar Tools Section -->
        <section class="mt-16 mb-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Similar Tools & Initiatives</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto">Explore other interactive tools and resources from Rotaract South Asia MDIO</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto">
                <!-- Rotaract Buddy -->
                <div class="group">
                    <a href="https://buddy.rsamdio.org/" target="_blank" rel="noopener noreferrer" 
                       class="block bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 hover:border-blue-300 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-blue-800 mb-2">Rotaract Buddy</h3>
                            <p class="text-sm text-blue-600 mb-3">AI-powered chatbot for all your Rotary & Rotaract questions</p>
                            <div class="flex items-center justify-center text-blue-500 group-hover:text-blue-600 transition-colors duration-300">
                                <span class="text-sm font-medium">View Resource</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 group-hover:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </div>
                        </div>
                    </a>
                </div>

                <!-- NAVIGATE -->
                <div class="group">
                    <a href="https://navigate.rsamdio.org/" target="_blank" rel="noopener noreferrer" 
                       class="block bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200 hover:border-green-300 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-green-800 mb-2">NAVIGATE</h3>
                            <p class="text-sm text-green-600 mb-3">Navigate your Rotaract journey with guided pathways</p>
                            <div class="flex items-center justify-center text-green-500 group-hover:text-green-600 transition-colors duration-300">
                                <span class="text-sm font-medium">View Resource</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 group-hover:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </div>
                        </div>
                    </a>
                </div>

                <!-- Publications Hub -->
                <div class="group">
                    <a href="https://connect.rsamdio.org/publications" target="_blank" rel="noopener noreferrer" 
                       class="block bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200 hover:border-purple-300 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-purple-800 mb-2">Publications Hub</h3>
                            <p class="text-sm text-purple-600 mb-3">Access the District Publications from across South Asia</p>
                            <div class="flex items-center justify-center text-purple-500 group-hover:text-purple-600 transition-colors duration-300">
                                <span class="text-sm font-medium">View Resource</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 group-hover:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </div>
                        </div>
                    </a>
                </div>

                <!-- Rotaract News Entry Submission -->
                <div class="group">
                    <a href="https://connect.rsamdio.org/rotaractnews" target="_blank" rel="noopener noreferrer" 
                       class="block bg-gradient-to-br from-orange-50 to-red-50 p-6 rounded-xl border border-orange-200 hover:border-orange-300 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-orange-800 mb-2">News Submission</h3>
                            <p class="text-sm text-orange-600 mb-3">Submit your updates for Rotaract News Magazine</p>
                            <div class="flex items-center justify-center text-orange-500 group-hover:text-orange-600 transition-colors duration-300">
                                <span class="text-sm font-medium">View Resource</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 group-hover:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </section>

        <footer class="mt-12 py-6 bg-gradient-to-br from-gray-25 to-gray-50 border-t border-gray-100">
            <div class="max-w-5xl mx-auto px-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-6">
                    <!-- Copyright & Organization -->
                    <div class="text-center md:text-left">
                        <h4 class="text-sm font-medium text-gray-500 mb-2">Rotaract South Asia MDIO</h4>
                        <p class="text-xs text-gray-400">© <span id="current-year"></span> All rights reserved.</p>
                    </div>

                    <!-- Contact Information -->
                    <div class="text-center">
                        <h4 class="text-sm font-medium text-gray-500 mb-2">Contact</h4>
                        <p class="text-xs text-gray-400 mb-1">PDRR Arun Teja Godavarthi</p>
                        <a href="mailto:rotaract3191drr@gmail.com" class="text-xs text-blue-500 hover:text-blue-600 transition-colors font-medium hover:underline">
                            rotaract3191drr@gmail.com
                        </a>
                    </div>

                    <!-- Disclaimer -->
                    <div class="text-center md:text-right">
                        <h4 class="text-sm font-medium text-gray-500 mb-2">Disclaimer</h4>
                        <p class="text-xs text-gray-400">All calculations are indicative estimates. Actual figures may vary based on various factors.</p>
                    </div>
                </div>

                <!-- Bottom Bar -->
                <div class="border-t border-gray-200 pt-4">
                    <div class="flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
                        <p class="text-xs text-gray-400 text-center sm:text-left">This tool is designed to help Rotaractors estimate their Club Invoice calculations efficiently and accurately.</p>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-400">Powered by</span>
                            <a href="https://rtr.zeospec.com/" target="_blank" rel="noopener noreferrer" class="text-xs font-medium text-gray-500 hover:text-gray-600 transition-colors">ZeoSpec</a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <script>
        // Performance optimization: Use requestIdleCallback for non-critical operations
        const requestIdleCallback = window.requestIdleCallback || ((cb) => setTimeout(cb, 1));
        
        document.addEventListener('DOMContentLoaded', () => {
            // Hide loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('active');
            }
            const addMemberForm = document.getElementById('add-member-form');
            const memberNameInput = document.getElementById('member-name');
            const memberTypeInput = document.getElementById('member-type');
            const joinDateInput = document.getElementById('join-date');
            const leaveDateInput = document.getElementById('leave-date');
            const memberRosterBody = document.getElementById('member-roster-body');
            const totalInvoiceAmountEl = document.getElementById('total-invoice-amount');
            const resetButton = document.getElementById('reset-button');
            const invoiceYearSelect = document.getElementById('invoice-year-select');
            const invoiceDateDisplay = document.getElementById('invoice-date-display');
            const currentYearSpan = document.getElementById('current-year');
            const taxPercentageInput = document.getElementById('tax-percentage');
            const baseInvoiceAmountEl = document.getElementById('base-invoice-amount');
            const taxBreakdownEl = document.getElementById('tax-breakdown');

            // Bulk upload elements
            const fileUploadArea = document.getElementById('file-upload-area');
            const fileInput = document.getElementById('file-input');
            const browseButton = document.getElementById('browse-button');
            const uploadPreview = document.getElementById('upload-preview');
            const previewContent = document.getElementById('preview-content');
            const confirmUpload = document.getElementById('confirm-upload');
            const cancelUpload = document.getElementById('cancel-upload');
            const downloadTemplate = document.getElementById('download-template');

            let parsedMembers = [];

            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const todayFormatted = `${yyyy}-${mm}-${dd}`;
            joinDateInput.value = todayFormatted;
            currentYearSpan.textContent = yyyy;

            let lastSelectedClubBase = memberTypeInput.value;
            let lastSelectedJoinDate = joinDateInput.value;

            // Bulk Upload Functions
            function downloadCSVTemplate() {
                const csvContent = 'Member Name,Join Date,Club Base,Leave Date\nJohn Doe,2024-01-01,Community-Based,\nJane Smith,2024-02-01,University-Based,2024-12-31';
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'rotaract_member_template.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }

            function parseExcelFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            
                            // Remove header row and process data
                            const processedData = jsonData.slice(1).filter(row => row.length >= 3);
                            resolve(processedData);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = reject;
                    reader.readAsArrayBuffer(file);
                });
            }

            function parseCSVFile(file) {
                return new Promise((resolve, reject) => {
                    Papa.parse(file, {
                        complete: function(results) {
                            if (results.errors.length > 0) {
                                reject(new Error('CSV parsing error: ' + results.errors[0].message));
                                return;
                            }
                            // Remove header row and process data
                            const processedData = results.data.slice(1).filter(row => row.length >= 3);
                            resolve(processedData);
                        },
                        error: function(error) {
                            reject(error);
                        }
                    });
                });
            }

            function validateMemberData(data) {
                const validatedMembers = [];
                const errors = [];

                data.forEach((row, index) => {
                    const [name, joinDate, memberType, leaveDate] = row;
                    
                    // Validate name
                    if (!name || typeof name !== 'string' || name.trim() === '') {
                        errors.push(`Row ${index + 2}: Invalid member name`);
                        return;
                    }

                    // Validate join date
                    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
                    if (!joinDate || !dateRegex.test(joinDate)) {
                        errors.push(`Row ${index + 2}: Invalid join date format (use YYYY-MM-DD)`);
                        return;
                    }

                    // Validate club base
                    const validTypes = ['Community-Based', 'University-Based'];
                    if (!validTypes.includes(memberType)) {
                        errors.push(`Row ${index + 2}: Invalid Club Base (use "Community-Based" or "University-Based")`);
                        return;
                    }

                    // Validate leave date (optional)
                    if (leaveDate && leaveDate.trim() !== '' && !dateRegex.test(leaveDate)) {
                        errors.push(`Row ${index + 2}: Invalid leave date format (use YYYY-MM-DD or leave blank)`);
                        return;
                    }

                    validatedMembers.push({
                        name: name.trim(),
                        joinDate: joinDate,
                        clubBase: memberType,
                        leaveDate: leaveDate && leaveDate.trim() !== '' ? leaveDate : null
                    });
                });

                return { validatedMembers, errors };
            }

            function showPreview(members) {
                const previewHTML = members.map((member, index) => {
                    const typeText = member.clubBase === 'Community-Based' ? 'Community-Based ($8)' : 'University-Based ($5)';
                    const leaveDateText = member.leaveDate ? ` | Left: ${member.leaveDate}` : '';
                    return `
                        <div class="flex justify-between items-center py-2 border-b border-gray-200 last:border-b-0">
                            <div class="flex-1">
                                <span class="font-medium text-gray-800">${member.name}</span>
                                <span class="text-gray-500 ml-3">${member.joinDate}${leaveDateText}</span>
                                <span class="text-gray-500 ml-3">${typeText}</span>
                            </div>
                        </div>
                    `;
                }).join('');

                previewContent.innerHTML = previewHTML;
                
                // Show the action buttons (Add to Roster and Cancel) - restore them if they were hidden
                const actionButtons = uploadPreview.querySelector('.flex.gap-3.mt-4');
                if (actionButtons) {
                    actionButtons.style.display = 'flex';
                }
                
                // Hide upload area with smooth transition
                fileUploadArea.classList.add('hidden');
                
                // Show preview after a short delay
                setTimeout(() => {
                    uploadPreview.classList.remove('hidden');
                }, 300);
            }

            function handleFileUpload(file) {
                // Show loading state
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.add('active');
                }
                
                const fileExtension = file.name.split('.').pop().toLowerCase();
                
                let parsePromise;
                if (fileExtension === 'csv') {
                    parsePromise = parseCSVFile(file);
                } else if (['xlsx', 'xls'].includes(fileExtension)) {
                    parsePromise = parseExcelFile(file);
                } else {
                    showErrorMessage('Unsupported file format. Please upload a CSV or Excel file.');
                    return;
                }

                parsePromise.then(data => {
                    const validation = validateMemberData(data);
                    
                    if (validation.errors.length > 0) {
                        const errorMessage = 'Validation errors found:\n\n' + validation.errors.join('\n');
                        showErrorMessage(errorMessage);
                        return;
                    }

                    parsedMembers = validation.validatedMembers;
                    showPreview(parsedMembers);
                }).catch(error => {
                    showErrorMessage('Error parsing file: ' + error.message);
                }).finally(() => {
                    // Hide loading state
                    if (loadingOverlay) {
                        loadingOverlay.classList.remove('active');
                    }
                });
            }

            function addBulkMembers() {
                if (parsedMembers.length === 0) return;

                const selectedYear = parseInt(invoiceYearSelect.value, 10);
                
                parsedMembers.forEach(member => {
                    const duesBreakdown = calculateIndividualDue(member.joinDate, member.clubBase, selectedYear, member.leaveDate);
                    const memberId = `member-${Date.now()}-${Math.random()}`;
                    
                    const row = document.createElement('tr');
                    row.id = memberId;
                    row.dataset.due = duesBreakdown.total;
                    row.dataset.joinDate = member.joinDate;
                    row.dataset.leaveDate = member.leaveDate;
                    row.dataset.memberType = member.clubBase;
                    row.dataset.name = member.name;
                    row.classList.add('member-row');
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">${member.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.joinDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.leaveDate || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.clubBase}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-medium due-cell">${formatDuesBreakdown(duesBreakdown)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button class="btn btn-secondary btn-sm !p-2 edit-member-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                            </button>
                            <button class="btn btn-danger btn-sm !p-2 remove-member-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                            </button>
                        </td>
                    `;
                    
                    memberRosterBody.appendChild(row);

                    row.querySelector('.edit-member-btn').addEventListener('click', () => editMember(memberId));
                    row.querySelector('.remove-member-btn').addEventListener('click', () => {
                        row.remove();
                        updateTotal();
                    });
                });

                updateTotal();
                
                // Show success animation and return to upload area
                showSuccessAnimation();
            }

            function resetBulkUpload() {
                parsedMembers = [];
                uploadPreview.classList.add('hidden');
                fileInput.value = '';
                
                // Return to upload area after a short delay
                setTimeout(() => {
                    fileUploadArea.classList.remove('hidden');
                }, 300);
            }
            
            function showSuccessAnimation() {
                // Replace preview content with success message
                const successHTML = `
                    <div class="text-center py-8 success-animation">
                        <div class="success-icon mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Successfully Added!</h3>
                        <p class="text-gray-600 mb-4">${parsedMembers.length} member(s) have been added to your roster.</p>
                        <div class="flex gap-3 justify-center">
                            <button type="button" id="upload-more-btn" class="btn btn-primary text-sm px-6 py-3 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                                Upload More
                            </button>
                        </div>
                    </div>
                `;
                
                // Replace the entire preview content (including buttons)
                previewContent.innerHTML = successHTML;
                
                // Hide the action buttons (Add to Roster and Cancel)
                const actionButtons = uploadPreview.querySelector('.flex.gap-3.mt-4');
                if (actionButtons) {
                    actionButtons.style.display = 'none';
                }
                
                // Add event listener for upload more button
                document.getElementById('upload-more-btn').addEventListener('click', () => {
                    resetBulkUpload();
                });
                
                // Auto-return to upload area after 3 seconds
                setTimeout(() => {
                    resetBulkUpload();
                }, 3000);
            }

            function populateYearSelector() {
                const currentYear = new Date().getFullYear();
                const startInvoiceYear = 2023;
                const endInvoiceYear = currentYear + 25;
                for (let year = startInvoiceYear; year <= endInvoiceYear; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    invoiceYearSelect.appendChild(option);
                }
                invoiceYearSelect.value = currentYear + 1;
                updateInvoiceDateDisplay();
            }

            function updateInvoiceDateDisplay() {
                const selectedYear = invoiceYearSelect.value;
                if(invoiceDateDisplay) invoiceDateDisplay.textContent = `Jan 1st, ${selectedYear}`;
            }

            function formatDuesBreakdown(duesBreakdown) {
                const { fullYear, prorated, total } = duesBreakdown;
                
                if (total === 0) {
                    return '<span class="text-gray-400">$0.00</span>';
                }
                
                let breakdown = '';
                
                if (fullYear > 0 && prorated > 0) {
                    breakdown = `$${fullYear.toFixed(2)} + $${prorated.toFixed(2)} = $${total.toFixed(2)}`;
                } else if (fullYear > 0) {
                    breakdown = `$${fullYear.toFixed(2)} + $0.00 = $${total.toFixed(2)}`;
                } else if (prorated > 0) {
                    breakdown = `$0.00 + $${prorated.toFixed(2)} = $${total.toFixed(2)}`;
                }
                
                return breakdown;
            }

            function calculateIndividualDue(joinDateStr, clubBase, invoiceYear, leaveDateStr = null) {
                const joinDate = new Date(joinDateStr + 'T00:00:00');
                const invoiceDate = new Date(invoiceYear, 0, 1); // January 1st of invoice year
                const baseDues = clubBase === 'Community-Based' ? 8 : 5;
                const joinYear = joinDate.getFullYear();

                // If joined in the year immediately preceding the invoice year
                if (joinYear === invoiceYear - 1) {
                    const joinMonth = joinDate.getMonth();
                    const joinDay = joinDate.getDate();
                    
                    // Logic: If member joins on the 1st of the month or before, that month is counted
                    // If member joins after the 1st of the month, that month is not counted
                    let effectiveJoinMonth = joinMonth;
                    if (joinDay > 1) {
                        // If joined after the 1st, don't count that month
                        effectiveJoinMonth += 1;
                    }
                    
                    // Calculate prorated months for join year (even if joined in December)
                    const monthsInJoinYear = Math.max(0, 12 - effectiveJoinMonth);
                    let proratedDues = (baseDues / 12) * monthsInJoinYear;

                    // Check if member left before invoice date
                    if (leaveDateStr) {
                        const leaveDate = new Date(leaveDateStr + 'T00:00:00');
                        if (leaveDate < invoiceDate) {
                            // Left before Jan 1st: charge only prorated dues for join year, but adjust for early departure
                            const leaveMonth = leaveDate.getMonth();
                            const leaveDay = leaveDate.getDate();
                            
                            // Logic for leave date: if they leave after the 1st, count that month
                            // If they leave on or before the 1st, don't count that month
                            let effectiveLeaveMonth = leaveMonth;
                            if (leaveDay > 1) {
                                effectiveLeaveMonth += 1;
                            }
                            
                            // Calculate actual months of membership in join year
                            // If leave month is before join month, no charge
                            if (effectiveLeaveMonth < effectiveJoinMonth) {
                                return { fullYear: 0, prorated: 0, total: 0, proratedMonths: 0 };
                            }
                            
                            // Calculate months based on effective join and leave months
                            let actualMonthsInJoinYear = effectiveLeaveMonth - effectiveJoinMonth;
                            
                            // Ensure months is not negative
                            actualMonthsInJoinYear = Math.max(0, actualMonthsInJoinYear);
                            proratedDues = (baseDues / 12) * actualMonthsInJoinYear;
                            
                            return { fullYear: 0, prorated: proratedDues, total: proratedDues, proratedMonths: actualMonthsInJoinYear };
                        }
                    }
                    // Still a member on Jan 1st: charge both base fee and prorated fee
                    return { fullYear: baseDues, prorated: proratedDues, total: baseDues + proratedDues, proratedMonths: monthsInJoinYear };
                }

                // If joined and left in the same year (not the year immediately preceding the invoice year), charge nothing
                if (joinYear >= invoiceYear) return { fullYear: 0, prorated: 0, total: 0, proratedMonths: 0 };

                // If left before Jan 1st, charge nothing
                if (leaveDateStr) {
                    const leaveDate = new Date(leaveDateStr + 'T00:00:00');
                    if (leaveDate < invoiceDate) return { fullYear: 0, prorated: 0, total: 0, proratedMonths: 0 };
                }

                if (joinYear < invoiceYear - 1) return { fullYear: baseDues, prorated: 0, total: baseDues, proratedMonths: 0 };
                return { fullYear: 0, prorated: 0, total: 0, proratedMonths: 0 };
            }

            // Debounced function for performance optimization
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            function updateTotal() {
                // Use requestIdleCallback for non-critical updates
                requestIdleCallback(() => {
                    let baseTotal = 0;
                    let totalFullYear = 0;
                    let totalProrated = 0;
                    let totalMembersWithFullYear = 0;
                    let totalProratedMonths = 0;
                    const selectedYear = parseInt(invoiceYearSelect.value, 10);
                    const memberRows = memberRosterBody.querySelectorAll('tr');
                    
                    memberRows.forEach(row => {
                        const joinDate = row.dataset.joinDate;
                        const leaveDate = row.dataset.leaveDate;
                        const memberType = row.dataset.memberType;
                        const duesBreakdown = calculateIndividualDue(joinDate, memberType, selectedYear, leaveDate);
                        
                        baseTotal += duesBreakdown.total;
                        totalFullYear += duesBreakdown.fullYear;
                        totalProrated += duesBreakdown.prorated;
                        
                        // Count members with full year dues
                        if (duesBreakdown.fullYear > 0) {
                            totalMembersWithFullYear++;
                        }
                        
                        // Add prorated months directly from the calculation
                        totalProratedMonths += duesBreakdown.proratedMonths || 0;
                    });
                    
                    // Calculate tax
                    const taxPercentage = parseFloat(taxPercentageInput.value) || 0;
                    const taxAmount = (baseTotal * taxPercentage) / 100;
                    const totalWithTax = baseTotal + taxAmount;
                    
                    // Update display with animation
                    baseInvoiceAmountEl.textContent = `$${baseTotal.toFixed(2)}`;
                    totalInvoiceAmountEl.textContent = `$${totalWithTax.toFixed(2)}`;
                    taxBreakdownEl.textContent = `Tax: $${taxAmount.toFixed(2)} (${taxPercentage}%)`;
                    
                    // Update dues breakdown
                    const duesBreakdownEl = document.getElementById('dues-breakdown');
                    if (duesBreakdownEl) {
                        duesBreakdownEl.textContent = `Full Year: $${totalFullYear.toFixed(2)} + Prorated: $${totalProrated.toFixed(2)}`;
                    }
                    
                    // Update new summary data
                    const totalMembersEl = document.getElementById('total-members');
                    const totalProratedMonthsEl = document.getElementById('total-prorated-months');
                    
                    if (totalMembersEl) {
                        totalMembersEl.textContent = totalMembersWithFullYear;
                    }
                    if (totalProratedMonthsEl) {
                        totalProratedMonthsEl.textContent = totalProratedMonths;
                    }
                    
                    // Show/hide empty state
                    const emptyState = document.getElementById('empty-state');
                    if (memberRows.length === 0) {
                        emptyState.classList.remove('hidden');
                    } else {
                        emptyState.classList.add('hidden');
                    }
                });
            }
            
            // Debounced version for input events
            const debouncedUpdateTotal = debounce(updateTotal, 300);
            
            function recalculateAllDues() {
                const selectedYear = parseInt(invoiceYearSelect.value, 10);
                const memberRows = memberRosterBody.querySelectorAll('tr');
                memberRows.forEach(row => {
                    if (row.classList.contains('editing')) return; // Skip editing rows
                    const joinDate = row.dataset.joinDate;
                    const leaveDate = row.dataset.leaveDate;
                    const memberType = row.dataset.memberType;
                    const duesBreakdown = calculateIndividualDue(joinDate, memberType, selectedYear, leaveDate);
                    row.dataset.due = duesBreakdown.total;
                    row.querySelector('.due-cell').innerHTML = formatDuesBreakdown(duesBreakdown);
                });
                updateTotal();
                updateInvoiceDateDisplay();
            }

            // Unified Form Validation System
            class FormValidator {
                constructor() {
                    this.errors = new Map();
                    this.validationRules = {
                        'member-name': [
                            { test: (value) => value.trim().length > 0, message: 'Member name is required' },
                            { test: (value) => value.trim().length >= 2, message: 'Name must be at least 2 characters' },
                            { test: (value) => /^[a-zA-Z\s]+$/.test(value.trim()), message: 'Name should only contain letters and spaces' }
                        ],
                        'member-type': [
                            { test: (value) => value.length > 0, message: 'Please select a Club Base' }
                        ],
                        'join-date': [
                            { test: (value) => value.length > 0, message: 'Join date is required' },
                            { test: (value) => this.isValidDate(value), message: 'Please enter a valid date' }
                        ],
                        'leave-date': [
                            { test: (value) => !value || this.isValidDate(value), message: 'Please enter a valid date' },
                            { test: (value) => !value || this.isLeaveDateValid(value), message: 'Leave date cannot be before join date' }
                        ]
                    };
                }

                isValidDate(dateString) {
                    const date = new Date(dateString);
                    return date instanceof Date && !isNaN(date);
                }

                isLeaveDateValid(leaveDate) {
                    const joinDate = document.getElementById('join-date').value;
                    if (!joinDate) return true; // If no join date, leave date is valid
                    
                    const leaveDateObj = new Date(leaveDate);
                    const joinDateObj = new Date(joinDate);
                    return leaveDateObj >= joinDateObj;
                }

                validateField(fieldId) {
                    const field = document.getElementById(fieldId);
                    if (!field || !this.validationRules[fieldId]) return true;

                    const value = field.value;
                    const rules = this.validationRules[fieldId];
                    
                    // Clear previous error for this field
                    this.clearFieldError(fieldId);
                    
                    // Check each validation rule
                    for (const rule of rules) {
                        if (!rule.test(value)) {
                            this.setFieldError(fieldId, rule.message);
                            return false;
                        }
                    }
                    
                    // If we get here, field is valid
                    this.setFieldSuccess(fieldId);
                    return true;
                }

                validateAll() {
                    this.clearAllErrors();
                    
                    let isValid = true;
                    const fieldIds = Object.keys(this.validationRules);
                    
                    for (const fieldId of fieldIds) {
                        if (!this.validateField(fieldId)) {
                            isValid = false;
                        }
                    }
                    
                    return isValid;
                }

                setFieldError(fieldId, message) {
                    const field = document.getElementById(fieldId);
                    const errorElement = document.getElementById(`${fieldId}-error`);
                    
                    if (field && errorElement) {
                        field.classList.remove('input-success');
                        field.classList.add('input-error');
                        errorElement.textContent = message;
                        errorElement.style.display = 'block';
                        
                        // Add error to our tracking
                        this.errors.set(fieldId, message);
                    }
                }

                setFieldSuccess(fieldId) {
                    const field = document.getElementById(fieldId);
                    const errorElement = document.getElementById(`${fieldId}-error`);
                    
                    if (field && errorElement) {
                        field.classList.remove('input-error');
                        field.classList.add('input-success');
                        errorElement.style.display = 'none';
                        errorElement.textContent = '';
                        
                        // Remove error from our tracking
                        this.errors.delete(fieldId);
                    }
                }

                clearFieldError(fieldId) {
                    const field = document.getElementById(fieldId);
                    const errorElement = document.getElementById(`${fieldId}-error`);
                    
                    if (field && errorElement) {
                        field.classList.remove('input-error', 'input-success');
                        errorElement.style.display = 'none';
                        errorElement.textContent = '';
                        
                        // Remove error from our tracking
                        this.errors.delete(fieldId);
                    }
                }

                clearAllErrors() {
                    document.querySelectorAll('.error-message').forEach(el => {
                        el.style.display = 'none';
                        el.textContent = '';
                    });
                    document.querySelectorAll('.input-error, .input-success').forEach(el => {
                        el.classList.remove('input-error', 'input-success');
                    });
                    this.errors.clear();
                }

                getFirstError() {
                    return this.errors.size > 0 ? this.errors.values().next().value : null;
                }

                hasErrors() {
                    return this.errors.size > 0;
                }
            }

            // Initialize form validator
            const formValidator = new FormValidator();
            
            // Legacy function for backward compatibility (now uses the new system)
            function showFieldError(fieldId, message, shouldFocus = false) {
                formValidator.setFieldError(fieldId, message);
                if (shouldFocus) {
                    const field = document.getElementById(fieldId);
                    if (field) field.focus();
                }
            }
            
            function showSuccessMessage(message) {
                const successDiv = document.createElement('div');
                successDiv.className = 'success-feedback fade-in';
                successDiv.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>${message}</span>
                `;
                
                // Insert after the form
                addMemberForm.parentNode.insertBefore(successDiv, addMemberForm.nextSibling);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    successDiv.remove();
                }, 3000);
            }
            
            function showErrorMessage(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-feedback fade-in';
                errorDiv.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>${message}</span>
                `;
                
                // Insert after the form
                addMemberForm.parentNode.insertBefore(errorDiv, addMemberForm.nextSibling);
                
                // Remove after 5 seconds
                setTimeout(() => {
                    errorDiv.remove();
                }, 5000);
            }
            
            function addMember(e) {
                // e.preventDefault() is now handled in the event listener
                
                // Use the new unified validation system
                if (!formValidator.validateAll()) {
                    // Show a summary error message if there are multiple errors
                    if (formValidator.errors.size > 1) {
                        showErrorMessage(`Please fix ${formValidator.errors.size} validation errors before submitting.`);
                    }
                    return;
                }
                
                const name = memberNameInput.value.trim();
                const clubBase = memberTypeInput.value;
                const joinDate = joinDateInput.value;
                const leaveDate = leaveDateInput.value;

                const selectedYear = parseInt(invoiceYearSelect.value, 10);
                const duesBreakdown = calculateIndividualDue(joinDate, clubBase, selectedYear, leaveDate);
                const memberId = `member-${Date.now()}`;
                const row = document.createElement('tr');
                row.id = memberId;
                row.dataset.due = duesBreakdown.total;
                row.dataset.joinDate = joinDate;
                row.dataset.leaveDate = leaveDate;
                row.dataset.memberType = clubBase;
                row.dataset.name = name;
                row.classList.add('member-row');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">${name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${joinDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${leaveDate || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${clubBase}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-medium due-cell">${formatDuesBreakdown(duesBreakdown)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="btn btn-secondary btn-sm !p-2 edit-member-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                        </button>
                        <button class="btn btn-danger btn-sm !p-2 remove-member-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                        </button>
                    </td>
                `;
                memberRosterBody.appendChild(row);

                row.querySelector('.edit-member-btn').addEventListener('click', () => editMember(memberId));
                row.querySelector('.remove-member-btn').addEventListener('click', () => {
                    row.remove();
                    updateTotal();
                });
                
                lastSelectedClubBase = clubBase;
                lastSelectedJoinDate = joinDate;
                updateTotal();
                
                // Clear all validation states before resetting
                formValidator.clearAllErrors();
                
                addMemberForm.reset();
                joinDateInput.value = lastSelectedJoinDate;
                memberTypeInput.value = lastSelectedClubBase;
                
                // Show success message
                showSuccessMessage('Member added successfully!');
                
                // Add success animation to the new row
                row.classList.add('slide-up');
            }

            function editMember(memberId) {
                const row = document.getElementById(memberId);
                if (!row || row.classList.contains('editing')) return;

                document.querySelectorAll('.edit-member-btn').forEach(btn => btn.disabled = true);
                row.classList.add('editing');

                const name = row.dataset.name;
                const joinDate = row.dataset.joinDate;
                const leaveDate = row.dataset.leaveDate;
                const memberType = row.dataset.memberType;

                // Enhanced input fields with better styling and visibility
                row.cells[0].innerHTML = `<input type="text" value="${name}" class="edit-mode-input" placeholder="Enter member name">`;
                row.cells[1].innerHTML = `<input type="date" value="${joinDate}" class="edit-mode-input">`;
                row.cells[2].innerHTML = `<input type="date" value="${leaveDate || ''}" class="edit-mode-input" placeholder="Leave date (optional)">`;
                row.cells[3].innerHTML = `
                    <select class="edit-mode-select">
                        <option value="Community-Based" ${memberType === 'Community-Based' ? 'selected' : ''}>Community-Based ($8)</option>
                        <option value="University-Based" ${memberType === 'University-Based' ? 'selected' : ''}>University-Based ($5)</option>
                    </select>
                `;
                row.cells[4].innerHTML = '<span class="text-gray-400 italic">Calculating...</span>';
                row.cells[5].innerHTML = `
                    <div class="flex space-x-2">
                        <button class="btn btn-primary btn-sm !p-2 save-member-btn" title="Save changes">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                        </button>
                        <button class="btn btn-secondary btn-sm !p-2 cancel-edit-btn" title="Cancel editing">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                `;

                // Add event listeners
                row.querySelector('.save-member-btn').addEventListener('click', () => saveMember(memberId));
                row.querySelector('.cancel-edit-btn').addEventListener('click', () => cancelEdit(memberId));
                
                // Auto-focus on the name input for better UX
                setTimeout(() => {
                    const nameInput = row.cells[0].querySelector('input');
                    if (nameInput) {
                        nameInput.focus();
                        nameInput.select();
                    }
                }, 100);
                
                // Add keyboard support for better UX
                const inputs = row.querySelectorAll('input, select');
                inputs.forEach((input, index) => {
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            if (index < inputs.length - 1) {
                                inputs[index + 1].focus();
                            } else {
                                saveMember(memberId);
                            }
                        } else if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelEdit(memberId);
                        }
                    });
                });
            }

            function saveMember(memberId) {
                const row = document.getElementById(memberId);
                if (!row) return;

                const newName = row.cells[0].querySelector('input').value.trim();
                const newJoinDate = row.cells[1].querySelector('input').value;
                const newLeaveDate = row.cells[2].querySelector('input').value;
                const newMemberType = row.cells[3].querySelector('select').value;

                // Enhanced validation for edit mode
                if (!newName) {
                    showErrorMessage('Please enter a member name');
                    row.cells[0].querySelector('input').focus();
                    return;
                }

                if (!newJoinDate) {
                    showErrorMessage('Please select a join date');
                    row.cells[1].querySelector('input').focus();
                    return;
                }

                row.dataset.name = newName;
                row.dataset.joinDate = newJoinDate;
                row.dataset.leaveDate = newLeaveDate;
                row.dataset.memberType = newMemberType;

                const selectedYear = parseInt(invoiceYearSelect.value, 10);
                const duesBreakdown = calculateIndividualDue(newJoinDate, newMemberType, selectedYear, newLeaveDate);
                row.dataset.due = duesBreakdown.total;

                row.cells[0].textContent = newName;
                row.cells[1].textContent = newJoinDate;
                row.cells[2].textContent = newLeaveDate || '-';
                row.cells[3].textContent = newMemberType;
                row.cells[4].innerHTML = formatDuesBreakdown(duesBreakdown);
                row.cells[4].classList.add('due-cell');
                
                finishEditing(row, memberId);
                recalculateAllDues();
                
                // Show success feedback
                row.style.backgroundColor = '#f0f9ff';
                setTimeout(() => {
                    row.style.backgroundColor = '';
                }, 1000);
            }

            function cancelEdit(memberId) {
                const row = document.getElementById(memberId);
                if (!row) return;

                const name = row.dataset.name;
                const joinDate = row.dataset.joinDate;
                const leaveDate = row.dataset.leaveDate;
                const memberType = row.dataset.memberType;
                const selectedYear = parseInt(invoiceYearSelect.value, 10);
                const duesBreakdown = calculateIndividualDue(joinDate, memberType, selectedYear, leaveDate);

                row.cells[0].textContent = name;
                row.cells[1].textContent = joinDate;
                row.cells[2].textContent = leaveDate || '-';
                row.cells[3].textContent = memberType;
                row.cells[4].innerHTML = formatDuesBreakdown(duesBreakdown);
                row.cells[4].classList.add('due-cell');

                finishEditing(row, memberId);
            }

            function finishEditing(row, memberId) {
                row.classList.remove('editing');
                row.cells[5].innerHTML = `
                    <button class="btn btn-secondary btn-sm !p-2 edit-member-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                    </button>
                    <button class="btn btn-danger btn-sm !p-2 remove-member-btn">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                    </button>
                `;
                row.querySelector('.edit-member-btn').addEventListener('click', () => editMember(memberId));
                row.querySelector('.remove-member-btn').addEventListener('click', () => {
                    row.remove();
                    updateTotal();
                });
                document.querySelectorAll('.edit-member-btn').forEach(btn => btn.disabled = false);
            }
            
            function resetCalculator() {
                memberRosterBody.innerHTML = '';
                updateTotal();
            }

            addMemberForm.addEventListener('submit', (e) => {
                e.preventDefault(); // Prevent default HTML5 validation
                addMember(e);
            });
            resetButton.addEventListener('click', resetCalculator);
            invoiceYearSelect.addEventListener('change', recalculateAllDues);
            taxPercentageInput.addEventListener('input', debouncedUpdateTotal);

            // Bulk upload event listeners
            browseButton.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFileUpload(file);
                }
            });

            // Drag and drop functionality
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file) {
                    handleFileUpload(file);
                }
            });

            confirmUpload.addEventListener('click', addBulkMembers);
            cancelUpload.addEventListener('click', resetBulkUpload);
            downloadTemplate.addEventListener('click', downloadCSVTemplate);

            // Initialize the application
            populateYearSelector();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + Enter to add member
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    const activeElement = document.activeElement;
                    if (activeElement && activeElement.closest('#add-member-form')) {
                        addMemberForm.dispatchEvent(new Event('submit'));
                    }
                }
                
                // Escape to close modals/overlays
                if (e.key === 'Escape') {
                    const loadingOverlay = document.getElementById('loading-overlay');
                    if (loadingOverlay && loadingOverlay.classList.contains('active')) {
                        loadingOverlay.classList.remove('active');
                    }
                }
            });
            
            // Add form field validation on blur using the new system
            [memberNameInput, memberTypeInput, joinDateInput, leaveDateInput].forEach(input => {
                if (input) {
                    input.addEventListener('blur', () => {
                        // Validate only the specific field that lost focus
                        formValidator.validateField(input.id);
                    });
                    
                    // Add real-time validation on input for better UX
                    input.addEventListener('input', () => {
                        // Clear error state when user starts typing/selecting
                        if (formValidator.errors.has(input.id)) {
                            formValidator.clearFieldError(input.id);
                        }
                    });
                }
            });
            
            // Performance optimization: Preload critical resources
            requestIdleCallback(() => {
                // Preload any additional resources if needed
                console.log('Application loaded successfully');
            });
        });
    </script>
</body>
</html>